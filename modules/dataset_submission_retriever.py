import cv2
import numpy as np
from torch.utils.data import Dataset

class DatasetSubmissionRetriever(Dataset):

    def __init__(self, data_root_path, image_names, transforms=None):
        super().__init__()
        self.data_root_path = data_root_path
        self.image_names = image_names
        self.transforms = transforms

    def __getitem__(self, index: int):
        image_name = self.image_names[index]
        image = cv2.imread(f'{self.data_root_path}/Test/{image_name}', cv2.IMREAD_COLOR)
        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB).astype(np.float32)
        image /= 255.0
        if self.transforms:
            sample = {'image': image}
            sample = self.transforms(**sample)
            image = sample['image']

        return image_name, image

    def __len__(self) -> int:
        return self.image_names.shape[0]